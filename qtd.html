<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Consulta BscScan - Última Transação</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      line-height: 1.6;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <h1>Consulta de Última Transação</h1>
  <p>Buscando a última transação do contrato na carteira <code>dead</code>...</p>
  <div id="result"></div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // URL alvo do BscScan e proxy para contornar problemas de CORS.
      const proxyUrl = "https://cors-anywhere.herokuapp.com/";
      const targetUrl = "https://bscscan.com/token/0x893535ED1b5C6969E62a10bABfED4F5fF8373278?a=0x000000000000000000000000000000000000dEaD";
      
      fetch(proxyUrl + targetUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error("Erro na requisição: " + response.status);
          }
          return response.text();
        })
        .then(htmlString => {
          // Converter o HTML retornado em um objeto DOM
          const parser = new DOMParser();
          const doc = parser.parseFromString(htmlString, "text/html");
          
          // Tenta localizar a tabela de transações (buscando o primeiro <tbody> encontrado)
          const tbody = doc.querySelector("table tbody");
          if (!tbody) {
            throw new Error("Tabela de transações não encontrada.");
          }
          
          // Seleciona a primeira linha da tabela (transação mais recente)
          const firstRow = tbody.querySelector("tr");
          if (!firstRow) {
            throw new Error("Nenhuma transação encontrada.");
          }
          
          // Extrai o transaction hash (buscando o link cujo href inicia com "/tx/")
          const hashLink = firstRow.querySelector('a[href^="/tx/"]');
          if (!hashLink) {
            throw new Error("Transaction hash não encontrada.");
          }
          const transactionHash = hashLink.textContent.trim();
          
          // Extrai a data da transação:
          // Primeiro, tenta encontrar um <span> com o atributo data-bs-title dentro de um <td> com a classe "showDate"
          let dateElement = firstRow.querySelector(".showDate span[data-bs-title]");
          let transactionDate = "";
          if (dateElement) {
            transactionDate = dateElement.getAttribute("data-bs-title").trim();
          } else {
            // Se não encontrar, tenta extrair o texto do <span> interno
            dateElement = firstRow.querySelector(".showDate span");
            if (dateElement) {
              transactionDate = dateElement.textContent.trim();
            } else {
              throw new Error("Data da transação não encontrada.");
            }
          }
          
          // Exibe os dados extraídos na página
          document.getElementById("result").innerHTML = `
            <p><strong>Transaction Hash:</strong> ${transactionHash}</p>
            <p><strong>Data da Transação:</strong> ${transactionDate}</p>
          `;
        })
        .catch(error => {
          // Em caso de erro, exibe uma mensagem apropriada
          document.getElementById("result").innerHTML = `<p class="error">Erro: ${error.message}</p>`;
        });
    });
  </script>
</body>
</html>
